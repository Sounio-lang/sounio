//@ run-pass
// Spawn and concurrent execution test

async fn slow_compute(n: i32) -> i32 with Async {
    // Simulate some work
    n * 10
}

fn main() with IO, Async {
    // Spawn a background task
    let handle = spawn {
        slow_compute(5).await
    }

    // Do other work while task runs
    let local_result = 100

    // Wait for spawned task
    let spawned_result = handle.await

    if spawned_result == 50 {
        print("spawn_basic: PASS\n")
    } else {
        print("spawn_basic: FAIL\n")
    }

    // Multiple spawns
    let h1 = spawn { slow_compute(1).await }
    let h2 = spawn { slow_compute(2).await }
    let h3 = spawn { slow_compute(3).await }

    let r1 = h1.await
    let r2 = h2.await
    let r3 = h3.await

    if r1 == 10 && r2 == 20 && r3 == 30 {
        print("spawn_multiple: PASS\n")
    } else {
        print("spawn_multiple: FAIL\n")
    }
}
